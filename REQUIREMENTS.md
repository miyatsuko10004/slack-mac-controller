# 要件定義書 (Requirements)

## 1. 概要
スマートフォンなどの外部端末から、Slackを介して自宅のMacを安全に遠隔操作するためのツール。
ルーターのポート開放などを一切行わず、Slack Socket Modeを用いることで、セキュアにローカルで `gemini` CLI を実行・結果取得できるようにする。

## 2. 機能要件

### 2.1 コマンド実行機能
ユーザーがSlack上でBot宛てにメンション付きでメッセージを送信することで、メッセージ内容をプロンプトとして `gemini` CLI を実行する。

*   **`gemini` コマンド**:
    *   形式: `@bot <プロンプト内容>`
    *   ローカルにインストールされた Gemini CLI を呼び出し、プロンプトに対する回答を生成してSlackに返す。
    *   **対象リポジトリの指定**: メッセージの先頭に `in <リポジトリ名>` を付けることで、特定のディレクトリ（デフォルト: `~/Desktop/develop` 以下）でGemini CLIを実行できる。

### 2.2 メッセージング機能
*   コマンドの実行結果（標準出力またはエラー出力）を、トリガーとなったSlackのチャンネルに返信する。
*   処理に時間がかかるため、「処理中...」という事前メッセージを送信し、完了後に結果を返す。

## 3. 非機能要件

### 3.1 セキュリティ
*   **Socket Modeによる通信**: Slack APIとの通信はSocket Modeを利用し、外部からのインバウンド通信を受け付けない（ポート開放不要）。
*   **アクセス制限**: Slack Appの権限設定により、特定のワークスペース・チャンネルからの指示のみを受け付ける。
*   **コマンドインジェクション対策**: 任意のシェルコマンドを許容するのではなく、内部的に `gemini` CLI の引数としてのみ実行し、サニタイズ処理（`shlex.quote` 等）を行う。

### 3.2 実行環境
*   **OS**: macOS環境 または WSL環境 を前提とする。
*   **前提ツール**: Python 3.x, Gemini CLIがインストールされ、パスが通っていること。
